---
layout: article
title: 了解MINIO
tags: MINIO
category: blog
date: 2022-07-27 16:56:00 +08:00
mermaid: true
---

## 官方文档
中文文档：[http://docs.minio.org.cn/docs/](http://docs.minio.org.cn/docs/)
英文文档：[https://docs.min.io/](https://docs.min.io/)

- **MinIO** 是一个基于Apache License v2.0开源协议的对象存储服务。它兼容亚马逊S3云存储服务接口，非
常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而
一个对象文件可以是任意大小，从几kb到最大5T不等。
- **MinIO**是一个非常轻量的服务,可以很简单的和其他应用的结合，类似 NodeJS, Redis 或者 MySQL。
官网：https://min.io/ http://www.minio.org.cn/
对象存储服务（Object Storage Service，OSS）是一种海量、安全、低成本、高可靠的云存储服
务，适合存放任意类型的文件。容量和处理能力弹性扩展，多种存储类型供选择，全面优化存储成
本。
对于中小型企业，如果不选择存储上云，那么 Minio 是个不错的选择，麻雀虽小，五脏俱全。当然
Minio 除了直接作为对象存储使用，还可以作为云上对象存储服务的网关层，无缝对接到 Amazon S3、
MicroSoft Azure。
在中国：阿里巴巴、腾讯、百度、中国联通、华为、中国移动等等9000多家企业也都在使用MinIO产
品。

## Minio优点

- 部署简单: 一个single二进制文件即是一切，还可支持各种平台。
minio支持海量存储，可按zone扩展(原zone不受任何影响)，支持单个对象最大5TB;
兼容Amazon S3接口，充分考虑开发人员的需求和体验
- 低冗余且磁盘损坏高容忍，标准且最高的数据冗余系数为2(即存储一个1M的数据对象，实际占用
磁盘空间为2M)。但在任意n/2块disk损坏的情况下依然可以读出数据(n为一个纠删码集合(Erasure
Coding Set)中的disk数量)。并且这种损坏恢复是基于单个对象的，而不是基于整个存储卷的。
读写性能优异
 

## MinIO的基础概念

- Object：存储到 Minio 的基本对象，如文件、字节流，Anything...
- Bucket：用来存储 Object 的逻辑空间。每个 Bucket 之间的数据是相互隔离的。对于客户端而
言，就相当于一个存放文件的顶层文件夹。
- Drive：即存储数据的磁盘，在 MinIO 启动时，以参数的方式传入。Minio 中所有的对象数据都会
存储在 Drive 里。
- Set ：即一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set ，每个 Set 中的
Drive 分布在不同位置。一个对象存储在一个 Set 上。（For example: {1...64} is divided into 4
sets each of size 16.）
一个对象存储在一个Set上
一个集群划分为多个Set
一个Set包含的Drive数量是固定的，默认由系统根据集群规模自动计算得出
一个SET中的Drive尽可能分布在不同的节点上

## Linux主机部署

```bash
wget https://dl.min.io/server/minio/release/linux-amd64/minio
chmod +x minio
mkdir -p /mnt/data
./minio server /mnt/data
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/ce9ba65dc92f4520b8ca7d617fdb7676.png)

> http://10.10.0.435815/

指定端口，用户名密码
```bash
export MINIO_ROOT_USER=admin
export MINIO_ROOT_PASSWORD=12345678
./minio server /mnt/data/ --console-address ":5000"
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/f0f213ad376c4d31b4482214304e4d73.png)

创建Bucket01，上传文件。

![在这里插入图片描述](https://img-blog.csdnimg.cn/4f47436f4fb34242adb7573e90d7dce8.png)



## 容器启动

```bash
docker run -d -p 9000:9000 -p 5000:5000 --name minio \
  -v /mnt/data:/data \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=12345678" \
   minio/minio server /data --console-address ":5000" 
```

## 纠删码
Minio使用纠刪码 erasure code 和校验和 checksum来保护数据免受硬件故障和无声数据损坏。即便丢失一半数量(N/2)的硬盘，仍然可以恢复数据。
纠删码是一种恢复丢失和损坏数据的数学算法，Minio 采用 Reed Solomon code将对象拆分成N/2数据和N/2 奇偶校验块，这就意味着如果是12块盘,一个对象会被分成6个数据块，6个奇偶校验块，你可以丢失任意6块盘(不管其是存放的数据块还是奇偶校验
(块)，你仍可以从剩下的盘中的数据进行恢复。

挂载8个盘
```bash
docker run -d -p 9000:9000 -p 5000:5000 --name minio \
  -v /mnt/data1:/data1 \
  -v /mnt/data2:/data2 \
  -v /mnt/data3:/data3 \
  -v /mnt/data4:/data4 \
  -v /mnt/data5:/data5 \
  -v /mnt/data6:/data6 \
  -v /mnt/data7:/data7 \
  -v /mnt/data8:/data8 \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=12345678" \
   minio/minio server /data{1..8} --console-address ":5000" 
```

新建Bucket，上传文件

![](https://img-blog.csdnimg.cn/a63541fa62154a189c67bf6b4bac16bf.png)


![在这里插入图片描述](https://img-blog.csdnimg.cn/1e0c73d1d2904b599107fca84f3a995a.png)



## 分布式存储可靠常用方法

分布式存储,很关键的点在于数据的可靠性，即保证数据的完整不丢失，不损坏，只有在可靠性实现的前提下，才有了追求一致性、高可用、高性能的基础。而对于在存储领域，一般对于保证数据可靠性的方法主要有两类，一类是冗余法，一类是校验法。

- 冗余法最简单直接，即对存储的数据进行副本备份，当数据出现丢失，损坏，即可使用备份内容进行恢复，而副本备份的多少，决定了 数据可靠性的高低，这其中会有成本的考量，副本数据越多，数据越可靠，但需要的设备就越多，成本就越高，可靠性是允许丢失其中一 份数据，当前已有很多分布式系统是采用此种方式实现，如 Hadoop 的文件系统 (3个副本)，Redis 的集群，MySQL 的主备模式等。

- 校验法即通过校验码的数学计算的方式，对出现丢失、损坏的数据进行校验、还原。注意，这里有两个作用，一个校验，通过对数据进行校验和(checksum)进行计算，可以检查数据是否完整，有无损坏或更改，在数据传输和保存时经常用到，如TCP协议；二是恢复还原， 通过对数据结合校验码，通过数学计算，还原丢失或损坏的数据，可以在保证数据可靠的前提下，降低冗余，如单机硬盘存储中的RAID 技术，纠删码(Erasure Code) 技术等。MinlO采用的就是纠删码技术。

## 分布式Minio优势
**数据保护**

- 分布式Minio采用纠删码来防范多个节点宕机和位衰减bit rot。
- 分布式Minio至少需要4个硬盘，使用分布式Minio自动引入了纠删码功能。

**高可用**

单机Minio服务存在单点故障，相反，如果是一个有块硬盘的分布式Minio，只要有N/2硬盘在线，你的数据就是安全的。不过你需要至少有N/2+1个硬盘来创建新的对象。

例如，一个16节点的Minio集群，每个节点16块硬盘，就算8台服务器宕机，这个集群仍然是可读的，不过你需要9台服務器才能写数据。

**一致性**

Minio在分布式和单机模式下，所有读写操作都严格遵守read-after-write一致性模型。

## 分布式集群部署

 **主机挂载多盘**

假如机器单点故障，则数据会丢失，所以要搭建分布式的集群

![在这里插入图片描述](https://img-blog.csdnimg.cn/83caf1e0f66e4ee9ba5137115b2068ed.png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/7c2234d0e4a94eceb886902d0acae0c5.png)


```bash
mkfs.ext4 /dev/sdb
mkfs.ext4 /dev/sdc
mount /dev/sdb /mnt/data1/ 
mount /dev/sdc /mnt/data2/

./minio server   --console-address ":5000"  http://10.0.2.11/mnt/data1 http://10.0.2.11/mnt/data2 
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/59763c2a7b76489294a3181a20afb417.png)

![在这里插入图片描述](https://img-blog.csdnimg.cn/cb09efd84a744cf289f3375807518735.png)

**docker-compose**

```bash
wget https://raw.githubusercontent.com/minio/minio/master/docs/orchestration/docker-compose/docker-compose.yaml
wget https://raw.githubusercontent.com/minio/minio/master/docs/orchestration/docker-compose/nginx.conf
docker-compose pull
docker-compose up
```

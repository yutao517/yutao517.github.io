---
layout: article
title: CCNP(二)－路由协议-EIGRP
tags: 计算机网络
category: blog
date: 2023-07-2１ 00:00:00 +08:00
mermaid: true
---
## 路由协议分类
**路由协议(英语：Routing protocol)** 是一种指定数据包转送方式的网络协议。Internet网络的主要节点设备是路由器，路由器通过路由表来转发接收到的数据。转发策略可以是人工指定的（通过静态路由、策略路由等方法）。在具有较小规模的网络中，人工指定转发策略没有任何问题。但是在具有较大规模的网络中（如跨国企业网络、ISP网络），如果通过人工指定转发策略，将会给网络管理员带来巨大的工作量，并且在管理、维护路由表上也变得十分困难。为了解决这个问题，动态路由协议应运而生。动态路由协议可以让路由器自动学习到其他路由器的网络，并且网络拓扑发生改变后自动更新路由表。网络管理员只需要配置动态路由协议即可，相比人工指定转发策略，工作量大大减少。


**路由协议的使用分类**

- **静态路由**：设置好路由器和主机并将路由信息固定的一种方法。

	优点：简便、可靠，在负荷稳定、拓扑变化不大的网络中运行效果很好，广泛用于高度安全性的军事网络和较小的商业网络。

	缺点：路由更新慢，不适用大型网络
- **动态路由**：路由协议在进行过程中自动的设置路由控制信息的一种方法。

	优点：路由更新快，适用于大型网络，及时响应链路费用或网络拓扑变化
	
	缺点：算法复杂，增加网络负担

![image](https://github.com/yutao517/yutao517.github.io/assets/62100249/378ba4a9-9ea9-4a16-8bb0-6b4063485dd6)

![image](https://github.com/yutao517/yutao517.github.io/assets/62100249/dc292b04-f458-4c9e-8cd7-9fd3adfa7c7a)

**路由协议作用的区域范围分类**：

按照范围分类，常见的路由协议有RIP、IGRP（Cisco私有协议）、EIGRP（Cisco私有协议）、OSPF、IS-IS、BGP等。　

- **内部网关协议(IGP)**：RIP、IGRP、EIGRP、OSPF、IS-IS。适用于单个ISP的统一路由协议的运行，一般由一个ISP运营的网络位于一个AS（自治系统）内，有统一的AS number（自治系统号）。

- **外部网关协议(EGP)**：BGP是自治系统间的路由协议，是一种外部网关协议，多用于不同ISP之间交换路由信息，以及大型企业、政府等具有较大规模的私有网络。


![image](https://github.com/yutao517/yutao517.github.io/assets/62100249/1e1eba9b-2b9e-451a-972c-8f5fcbda3caf)

**路由协议使用的算法分类**

- **距离矢量路由协议(DV)**：**RIP**(Routing Information Protocols，路由信息协议)
- **链路状态路由协议(LS)**：最短路径优先（OSPF），中间系统到中间系统（IS-IS）

- **混合性**：**IGRP**和**EIGRP**均有以上两种特点，IGRP是CISCO专有的协议，只在CISCO路由器中实现；EIGRP协议是IGRP的增强版，它也是CISCO专有的路由协议，EIGRP是一种高级距离矢量路由协议（也称混合型路由协议）。

**路由协议有无类分类**
- **有类(Classful)网络** ：较早期，较垃圾。不支持子网掩码。例如：RIP v1, IGRP ,EGP
- **无类(Classless)网络**：现今一般三层设备大都是无类，携带子网掩码。无类网络中才能部署vlsm。例如：IP v2 ,EIGRP, OSPF, IS-IS, BGP



**常见内部路由协议比较表**


![image](https://github.com/yutao517/yutao517.github.io/assets/62100249/ace6d144-1ece-4879-9f93-48cedb2d758b)


## EIGRP

EIGRP增强型内部网关路由协议，一种内部网关协议（IGP）。在内部网关路由协议（IGRP）的基础上，由思科公司发展而成，于2013年Cisco将此标准公开，不再是私有的路由协议。EIGRP是一种高级距离矢量路由协议（也称混合型路由协议）。

**EIGRP特点**

- 封装在IP报头的协议，ip协议号88
- 快速收敛。EIGRP采用DUAL来实现快速收敛。运行EIGRP的路由器存储了邻居的路由表，因此能够快速适应网络中的变化。如果本地路由表中没用合适的路由且拓扑表中没用合适的备用路由，EIGRP将查询邻居以发现替代路由。查询将不断传播，直到找到替代路由或确定不存在替代路由。收敛速度快，100%无环路。
- EIGRP是一种无类路由协议，它将通告每个目标网络的子网掩码，支持不连续子网和VLSM。
- 部分更新。EIGRP发送部分更新而不是定期更新，且仅在路由路径或者度量值发生变化时才发送。更新中只包含已变化的链路的信息，而不是整个路由表，可以减少带宽的占用。此外，还自动限制这些部分更新的传播，只将其传递给需要的路由表，因此EIGRP消耗的带宽比IGRP少很多。这种行为也不同于链路状态路由协议，后者将更新发送给区域内的所有路由器。
- 支持多种网络层协议。EIGRP使用协议无关模块来支持IPv4、IPv6、Apple Talk和IPX，以满足特定网络层需求。
- 使用多播和单播。EIGRP在路由器之间通信时使用多播和单播而不是广播，因此终端站不受路由更新和查询的影响。EIGRP使用的多播地址是224.0.0.10
- 支持非等价负载均衡。

**EIGRP有以下四个基本组件和关键技术**

- 邻居发现和恢复（Neighbor discovery/recovery）：邻居发现和恢复机制使得运行EIGRP的路由器可以自动的发现与之直接相连的其他运行EIGRP的路由器，并与它们创建邻居关系。邻居发现和恢复机制还维护路由器与其他路由器之间的邻居关系。EIGRP路由器通过发送Hello包来创建和维护邻居关系，如果在一定的时间间隔内没有收到邻居路由器发来的Hello包，则认为该邻居已经死亡，并中断邻居关系，将邻居从邻居表中清除。
- 可靠传输协议（Reliable Transport Protocol RTP）：可靠传输协议的作用是保障EIGRP协议数据包的可靠的、有序的传送。RTP同时使用单播和组播来传送EIGRP协议数据包。有些类型的EIGRP数据包必须被可靠的传送，有些则无需可靠的传送。所谓可靠的传送，即发送的数据包需要被接收方显示或隐式的确认。
- DUAL有限状态机（DUAL finite-state machine DUAL FSM）：DUAL有限状态机是EIGRP用来计算最佳路径的机制。这是一个扩散更新算法。
- 协议相关模块（Protocol-dependent modules PDMs ）：协议相关模块的引进，使得EIGRP可以支持不同的网络层协议，如IPX、AppleTalk、IPv6，而不仅仅是IPv4协议。

**IGRP所收集的信息存放在以下三个表中**

- 邻居表（Neighbor Table）：用来存放和邻居路由器相关的数据。如邻居路由器IP地址、与邻居路由器相连的本地接口、保持时间等。确保直接邻居之间能够双向通信。
- 拓扑表（Topology Table）：该表用来存放所有从邻居路由器学习到的路径信息，拓扑表中存放着前往目标地址的所有路由。拓扑表中的每一条路径都至少有一个后继（Successor）。该表中的每一条路径信息可以被标记为被动（Passive）状态或者活动（Active）状态。被动状态说明此路径处于稳定状态，并且路由器知道如何到达该目的地。活动状态则说明网络拓扑发生变化，并且路由器正在处理相关信息，以得到一条新的到达该目的地的最佳路径。
- 路由表（Routing Table）：拓扑表中的后继（Successor）会被放入路由表，路由器根据路由表来转发数据包，从拓扑表中选择到达目标地址的最佳路由放入路由表。

**通告距离和可行距离**
- 通告距离（Advertised Distance，AD）是到目的地的下一跳路由器到该目的地的度量值。通告距离的英文也可写作Reported Distance（RD）。
- 可行距离（Feasible Distance，FD）是路由器到某目的地的最低度量值。FD等于AD加上从当前路由器到下一跳路由器的度量值。

FD和AD描述的就是metric值（路由开销）。

**EIGRP五种数据包：**
- Hello：建立邻居关系
- 更新(Update)：传递路由协议
- 查询(Query)：丢包发送查询报文
- 回复(REPLY)：回应查询报文
- ACK：确认可靠报文


**EIGRP的Metric值计算：**

EIGRP Metric = 256 * (IGRP Metric)    (256=8bit)
K1＝带宽bandwidth（源和目的之间的最小带宽）　　 　　
K2＝负载loading（源和目的之间的最大负载 ）          
K3＝延迟delay（源和目的之间的延迟总和）　　　       
K4＝可靠性reliability（源和目的之间的最低可靠性）   
K5＝MTU（源和目的之间的最小MTU）　　　            
